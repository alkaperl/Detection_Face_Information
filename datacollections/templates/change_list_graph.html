{% extends "admin/change_list.html" %} 
{% load staticfiles %} 
{% block extrahead%}
<link
  rel="stylesheet"
  type="text/css"
  href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.js"></script>
<script>
  function randomColorGenerator() {
      return '#' + (Math.random().toString(16) + '0000000').slice(2, 8);
  };
    const timeFormat = 'HH';
    const hours = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24];
  var options = {
      responsive: true,
      maintainAspectRatio: true,
      legend: {
          position: 'left'
      },
      title: {
          display: true
      },
      animation: {
          animateScale: true,
          animateRotate: true
      }
  };

  /*
  data_gender
  data_age
  created
  updated
  products
  */
  window.onload = function () {
      let ctx = document.getElementById("gender-chart");
      {% regroup cl.queryset|dictsort:"data_gender" by get_data_gender_display as gender_list %}
      let lineChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
              labels: [{% for gender in gender_list %}'{{ gender.grouper }}',{% endfor %}],
              datasets: [{
                  data: [{% for gender in gender_list %}'{{ gender.list|length }}',{% endfor %}],
                  backgroundColor: [{% for gender in gender_list %}randomColorGenerator(),{% endfor %}]
              }]
          },
          options: options
      });

      ctx = document.getElementById("model-chart");
      let temp=[];
      let bg=[];
      let dats = {};
      let name
     {% for object in cl.result_list %}
      name = "{{ object.products}}";
      if(temp.indexOf(name)==-1){
          temp.push(name);
          bg.push(randomColorGenerator())
          dats[name]=1;
      }
      else dats[name]++;
      {% endfor %}
      console.log(dats);
      lineChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
              labels: Object.keys(dats),
              datasets: [{
                  data: Object.values(dats),
                  backgroundColor: bg,
              }]
          },
          options: options
      });
    /*
      ctx = document.getElementById("time-chart");
       {% for object in cl.result_list %}
            console.log("{{object.created.hour}}")
         {% endfor %}
      lineChart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: hours,
              datasets: [{
                  data: [20,21,22,23,24,5,26,27,28,29,30],
                  borderColor:randomColorGenerator()
              }]
          },
          options: {
                responsive: true,
              scales: {
                  xAxes: [{
                      type: 'time',
                      time: {
                          format : timeFormat,
                          unit: 'minute',
                      }
                  }]
              }
          }
      });
  }
  */
</script>
{% endblock extrahead %} 
{% block content %}
<h1>Graphs</h1>
<hr />
<div class="row">
  <div class="col-sm-4">
    <canvas id="gender-chart" style="width: 100px !important;"></canvas>
  </div>
  <div class="col-sm-4">
    <canvas id="model-chart" style="width: 100px !important;"></canvas>
  </div>
</div>
<div class="row">
  <div class="col-sm-4">
    <canvas id="time-chart" style="width: 100px !important;"></canvas>
  </div>
</div>
{{ block.super }} 
{% endblock content%}
