{% extends "admin/change_list.html" %} 
{% load staticfiles %} 
{% block extrahead %}
<link
  rel="stylesheet"
  type="text/css"
  href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.js"></script>
<script>
function randomColorGenerator() {
    return '#' + (Math.random().toString(16) + '0000000').slice(2, 8);
};
const timeFormat = 'HH';
const hours = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];
var options = {
    responsive: true,
    maintainAspectRatio: true,
    legend: {
        position: 'left'
    },
    title: {
        display: true
    },
    animation: {
        animateScale: true,
        animateRotate: true
    }
};

window.onload = function () {
    let ctx = document.getElementById("gender-chart");
    {% regroup cl.queryset|dictsort:"data_gender" by get_data_gender_display as gender_list %}
    let lineChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: [{% for gender in gender_list %}'{{ gender.grouper }}',{% endfor %}],
            datasets: [{
                data: [{% for gender in gender_list %}'{{ gender.list|length }}',{% endfor %}],
                backgroundColor: [{% for gender in gender_list %}randomColorGenerator(),{% endfor %}]
            }]
        },
        options: options
    });
    ctx = document.getElementById("model-chart");
    let temp=[];
    let bg=[];
    let dats = {};
    let name
    {% for object in cl.result_list %}
    name = "{{ object.products}}";
    if(temp.indexOf(name)==-1){
        temp.push(name);
        bg.push(randomColorGenerator())
        dats[name]=1;
    }
    else dats[name]++;
    {% endfor %}
    lineChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(dats),
            datasets: [{
                data: Object.values(dats),
                backgroundColor: bg,
            }]
        },
        options: options
    });
    dats = {};
    temp=[];
    for(let i in hours){
        dats[i]=0;
    }
    ctx = document.getElementById("time-chart");
    {% for object in cl.result_list %}
       dats["{{object.created.hour}}"]++;
    {%endfor%}
    lineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Object.keys(dats),
            datasets: [{
                data: Object.values(dats),
                borderColor:randomColorGenerator()
            }]
        },
        options: {
            responsive:true,
            legend: {
                display:false,
            },
            title: {
                display: true
            },
            animation: {
                animateScale: true,
                animateRotate: true
            },
            scales:{
                yAxes:[{
                    ticks:{
                        min:0,
                        stepSize:5,
                    },
                }]
            }
        }
    });      
}

</script>
{% endblock extrahead %} 
{% block content %}
<h1>Graphs</h1>
<hr />
<div class="row">
  <div class="col-sm-4">
    <canvas id="gender-chart" style="width: 100 !important;"></canvas>
  </div>
  <div class="col-sm-4">
    <canvas id="model-chart" style="width: 100px !important;"></canvas>
  </div>
</div>
<div class="row">
    <canvas id="time-chart" style="width:500px; height:200px !important"></canvas>
</div>
{{ block.super }} 
{% endblock content%}
